NationSwell
===========

This repository contains all code for the NationSwell website found at http://nationswell.org/. 

* /wp-content/plugins  = Contains all contributed plugins 
* /wp-content/themes/nationswell = Custom theme

## Wordpress updates
* Managed by the hosting company




## Wordpress plugin updates
* Download the new versions of the plugins you wish to update from wordpress.org
* Unzip and replace your local files with the updates
* Commit to master 
* Push to staging then production

-----
#### Local environment setup

1. Check out this repo
2. Install wordpress into the newly created directory, make sure you have configured your `.gitignore` file to exclude any WordPress files from your commits. These are managed by the host.
3. Installed plugins (copy from production), these are managed manually via FTP and are not stored in a repo.
4. If using apache, set up the .htaccess with the static files rewrite rule. On production, static files are pushed into the CDN.
```
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteRule ^static/\d+/(css|img|fonts|js)/(.*) /wp-content/themes/nationswell/$1/$2 [QSA,L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress
```
5. Log on to the hosting companyâ€™s admin dashboard and download a copy of the database, install on your local instance of mySQL, update `wp-config.php` file accordingly.

-----
#### General development environment setup (optional)

1. Install virtualbox: https://www.virtualbox.org/
2. Install Vagrant: http://www.vagrantup.com/
3. Install the vagrant-hostsupdater plugin `vagrant plugin install vagrant-hostsupdater`
4. `git clone https://github.com/10up/varying-vagrant-vagrants nationswell`
5. `cd nationswell`
6. `vagrant up`
7. `cd www/wordpress-default`
8. `git clone https://github.com/ronik-design/nationswell.git`
9. `cd nationswell`
10. `mv .git ..`
11. `cd ..`
12. `git reset HEAD --hard`
13. `rm -rf nationswell`

14. `vagrant ssh`, then access `/etc/nginx/nginx-wp-common.conf`
15. Add this nginx location directive to nginx-wp-common.conf directly above `location ~ \.php$ {`
```
location ~ ^/static/\d+/(js|fonts|img|css)/(.*)$ {
  try_files $uri $uri/ /wp-content/themes/nationswell/$1/$2;
}
```
16. Restart nginx `sudo /etc/init.d/nginx restart`
17. Install and Activate Wordpress Plugins and NationSwell theme 
```
cd /vagrant/www/wordpress-default`
chmod +x init.sh
./init.sh
```

-----
#### Dependencies

1. git `http://git-scm.com/book/en/Getting-Started-Installing-Git`
2. ruby
3. npm
4. brew `http://brew.sh/`
5. grunt `npm install -g grunt-cli`
6. Xquartz - http://xquartz.macosforge.org/landing/
7. Bundler - http://bundler.io/

-----
#### Theme development

1. Change to theme directory: `cd wp-content/themes/nationswell`
2. Run: `npm install`
3. Run: `bundle install`
4. Assuming that the Grunt CLI has been installed and that the project has already been configured with a package.json and a Gruntfile.
5. Icons are generated by adding SVG files to the icons dir and running `grunt webfont`. Make sure you have `ttfautohint fontforge` installed (`brew install ttfautohint fontforge --with-python`). Once the fonts have been generated, run `grunt` to rebuild files.
6. Run: `grunt watch` to start watching for changed files.




